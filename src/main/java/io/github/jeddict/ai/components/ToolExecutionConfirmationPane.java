/**
 * Copyright 2025-2026 the original author or authors from the Jeddict project
 * (https://jeddict.github.io/).
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy of
 * the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
package io.github.jeddict.ai.components;

import dev.langchain4j.agent.tool.ToolExecutionRequest;
import io.github.jeddict.ai.util.UIUtil;
import java.awt.Dimension;
import javax.swing.JOptionPane;
import javax.swing.JPanel;

/**
 * A JPanel component designed to display tool execution requests and obtain user consent.
 * This panel provides a visual interface for users to review and approve or reject
 * the execution of specific tools within the application. It includes functionality
 * to dynamically update the displayed tool information and handle user responses.
 */
public class ToolExecutionConfirmationPane extends JPanel {

    /**
     * Creates new form ToolExecutionConfirmationPane
     */
    public ToolExecutionConfirmationPane() {
        initComponents();
        setVisible(false);
        
        //
        // Actions
        //
        acceptButton.addActionListener((e) -> {
            close(JOptionPane.YES_OPTION);
        });
        
        rejectButton.addActionListener((e) -> {
            close(JOptionPane.NO_OPTION);
        });
        
        UIUtil.makeDefaultButton(acceptButton);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        headerPane = new io.github.jeddict.ai.components.ToolInvocationPane();
        actionPane = new javax.swing.JPanel();
        confirmationLabel = new javax.swing.JLabel();
        acceptButton = new javax.swing.JButton();
        rejectButton = new javax.swing.JButton();

        setBackground(UIUtil.COLOR_JEDDICT_MAIN_BACKGROUND);
        setBorder(UIUtil.BORDER_JEDDICT_SPACED_LINE_1);
        setMaximumSize(new java.awt.Dimension(32767, 250));
        setMinimumSize(new java.awt.Dimension(300, 100));
        setName("toolConfirmation"); // NOI18N
        setPreferredSize(new java.awt.Dimension(32767, 100));
        setLayout(new javax.swing.BoxLayout(this, javax.swing.BoxLayout.Y_AXIS));

        headerPane.setBorder(javax.swing.BorderFactory.createEmptyBorder(3, 3, 3, 3));
        headerPane.setOpaque(false);
        add(headerPane);

        actionPane.setBorder(javax.swing.BorderFactory.createEmptyBorder(2, 0, 2, 0));
        actionPane.setName("actionPane"); // NOI18N
        actionPane.setOpaque(false);
        actionPane.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.RIGHT, 5, 0));

        org.openide.awt.Mnemonics.setLocalizedText(confirmationLabel, "I'd like to execute %s ..."); // NOI18N
        confirmationLabel.setName("confirmationLabel"); // NOI18N
        actionPane.add(confirmationLabel);

        org.openide.awt.Mnemonics.setLocalizedText(acceptButton, "Accept"); // NOI18N
        acceptButton.setName("acceptAction"); // NOI18N
        acceptButton.addActionListener(this::acceptButtonActionPerformed);
        actionPane.add(acceptButton);

        org.openide.awt.Mnemonics.setLocalizedText(rejectButton, "Reject"); // NOI18N
        rejectButton.setName("rejectAction"); // NOI18N
        actionPane.add(rejectButton);

        add(actionPane);
    }// </editor-fold>//GEN-END:initComponents

    private void acceptButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_acceptButtonActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_acceptButtonActionPerformed

    public void showMessage(final ToolExecutionRequest execution) {
        remove(headerPane);
        add(headerPane = new ToolInvocationPane(execution), 0);
        confirmationLabel.setText(confirmationLabel.getText().formatted(execution.name()));
        setVisible(true);
    }

    @Override
    public Dimension getMaximumSize() {
        return new Dimension(Integer.MAX_VALUE, getPreferredSize().height);
    }
    
    private void close(final int action) {
        firePropertyChange(JOptionPane.VALUE_PROPERTY, -1, action);
        setVisible(false);
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton acceptButton;
    private javax.swing.JPanel actionPane;
    private javax.swing.JLabel confirmationLabel;
    private io.github.jeddict.ai.components.ToolInvocationPane headerPane;
    private javax.swing.JButton rejectButton;
    // End of variables declaration//GEN-END:variables
}
